# 配置文件说明

## 📋 配置方式（参考公司项目 yx-im）

本项目采用 **Spring Profiles** 方式区分不同环境，所有配置都打包在JAR中：

- `application.yml` - 公共配置（默认环境：dev）
- `application-dev.yml` - 开发环境配置（本地开发）
- `application-prod.yml` - 生产环境配置（服务器部署）

## 🚀 使用方式

### 开发环境（本地）
```bash
# 直接运行，默认使用 dev 环境
java -jar xl-im-admin-1.0.0.jar

# 或明确指定
java -jar xl-im-admin-1.0.0.jar --spring.profiles.active=dev
```

### 生产环境（服务器）
```bash
# 使用生产环境配置
java -jar xl-im-admin-1.0.0.jar --spring.profiles.active=prod

# 或使用启动脚本（推荐）
./start.sh
```

## ⚙️ 配置修改

### 1. 修改生产环境配置

编辑 `xl-im-admin/src/main/resources/application-prod.yml`，修改以下配置：

```yaml
# 数据库配置
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/xl_im?...
    username: root
    password: your_password_here  # ⚠️ 修改为实际密码
  
  # Redis配置
  data:
    redis:
      host: localhost
      port: 6379
      password:  # 如果设置了密码，请填写
  
  # MongoDB配置
    mongodb:
      uri: mongodb://localhost:27017/xl_im

# 文件上传配置
file:
  upload:
    path: /www/wwwroot/uploads  # 文件存储路径
    base-url: http://159.75.243.81/uploads  # 文件访问地址

# CORS跨域配置
cors:
  allowed-origins:
    - http://159.75.243.81  # 添加前端访问地址
```

### 2. 重新打包

修改配置后，需要重新打包：

```bash
cd xl-im-backend
mvn clean package -DskipTests
```

### 3. 上传到服务器

将新打包的 `xl-im-admin/target/xl-im-admin-1.0.0.jar` 上传到服务器的 `/www/wwwroot/xl-im/` 目录。

## 📝 与公司项目的区别

| 项目 | 配置方式 | 特点 |
|------|---------|------|
| **yx-im（公司项目）** | 直接写配置在 `application-pro.yml` | ✅ 简单直接<br>❌ 密码暴露在JAR中 |
| **xl-im（当前项目）** | 直接写配置在 `application-prod.yml` | ✅ 简单直接<br>⚠️ 密码暴露在JAR中（如需要更安全，可使用环境变量） |

## 🔒 可选：使用环境变量（更安全）

如果希望更安全，可以继续使用环境变量方式：

1. **修改 `application-prod.yml`**，使用环境变量语法：
   ```yaml
   spring:
     datasource:
       password: ${DB_PASSWORD:默认密码}
   ```

2. **创建 `.env` 文件**（服务器上）：
   ```bash
   cd /www/wwwroot/xl-im
   vim .env
   ```
   
   内容：
   ```env
   DB_PASSWORD=实际密码
   REDIS_PASSWORD=Redis密码
   ```

3. **`start.sh` 会自动加载 `.env` 文件**（如果存在）。

## 📌 注意事项

1. **密码安全**：如果直接写在配置文件中，密码会包含在JAR包中。如果JAR包泄露，密码也会泄露。
2. **配置修改**：修改配置后必须重新打包和部署。
3. **默认端口**：生产环境默认端口是 `20250`，如需修改请编辑 `application-prod.yml`。

## 🎯 推荐流程

1. 开发阶段：使用 `application-dev.yml`（本地数据库）
2. 部署阶段：
   - 修改 `application-prod.yml` 为服务器实际配置
   - 打包：`mvn clean package -DskipTests`
   - 上传JAR到服务器
   - 执行 `./start.sh` 启动

