<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xl.system.mapper.MenuMapper">

    <resultMap id="BaseResultMap" type="com.xl.system.entity.Menu">
        <id column="id" property="id" />
        <result column="system_id" property="systemId" />
        <result column="menu_name" property="menuName" />
        <result column="full_name" property="fullName" />
        <result column="en_code" property="enCode" />
        <result column="parent_id" property="parentId" />
        <result column="order_num" property="orderNum" />
        <result column="sort_code" property="sortCode" />
        <result column="path" property="path" />
        <result column="url_address" property="urlAddress" />
        <result column="component" property="component" />
        <result column="query" property="query" />
        <result column="is_frame" property="isFrame" />
        <result column="is_cache" property="isCache" />
        <result column="menu_type" property="menuType" />
        <result column="type" property="type" />
        <result column="category" property="category" />
        <result column="visible" property="visible" />
        <result column="status" property="status" />
        <result column="enabled_mark" property="enabledMark" />
        <result column="perms" property="perms" />
        <result column="icon" property="icon" />
        <result column="link_target" property="linkTarget" />
        <result column="property_json" property="propertyJson" />
        <result column="remark" property="remark" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
        <result column="deleted" property="deleted" />
    </resultMap>

    <sql id="Base_Column_List">
        id, system_id, menu_name, full_name, en_code, parent_id, order_num, sort_code, path, url_address, 
        component, query, is_frame, is_cache, menu_type, type, category, visible, status, enabled_mark, 
        perms, icon, link_target, property_json, remark, create_time, update_time, deleted
    </sql>

    <select id="selectMenuListByUserId" parameterType="Long" resultMap="BaseResultMap">
        SELECT DISTINCT m.*
        FROM sys_menu m
        LEFT JOIN sys_role_menu rm ON m.id = rm.menu_id
        LEFT JOIN sys_user_role ur ON rm.role_id = ur.role_id
        WHERE ur.user_id = #{userId}
          AND m.deleted = 0
          AND m.status = '0'
          AND m.enabled_mark = 1
        ORDER BY m.parent_id, m.sort_code, m.order_num
    </select>

    <select id="selectMenuListByRoleId" parameterType="Long" resultMap="BaseResultMap">
        SELECT DISTINCT m.*
        FROM sys_menu m
        LEFT JOIN sys_role_menu rm ON m.id = rm.menu_id
        WHERE rm.role_id = #{roleId}
          AND m.deleted = 0
          AND m.status = '0'
          AND m.enabled_mark = 1
        ORDER BY m.parent_id, m.sort_code, m.order_num
    </select>

    <select id="selectMenuTreeByUserId" parameterType="Long" resultMap="BaseResultMap">
        SELECT DISTINCT m.*
        FROM sys_menu m
        LEFT JOIN sys_role_menu rm ON m.id = rm.menu_id
        LEFT JOIN sys_user_role ur ON rm.role_id = ur.role_id
        WHERE ur.user_id = #{userId}
          AND m.deleted = 0
          AND m.status = '0'
          AND m.enabled_mark = 1
          AND m.visible = '0'
        ORDER BY m.parent_id, m.sort_code, m.order_num
    </select>

</mapper>


